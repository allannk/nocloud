version: "3.9"

volumes:
  postgres-data:

secrets:
  postgres_user:
    file: secrets/postgres_user
  postgres_password:
    file: secrets/postgres_password

services:
  proxy:
    image: jwilder/nginx-proxy
    ports:
      - "80:80"
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro

  whoami:
    image: jwilder/whoami
    environment:
      - VIRTUAL_HOST=whoami.local

  nginx:
    build: ./nginx
    environment:
      - VIRTUAL_HOST=app.localhost
    expose:
      - 80
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro

  postgres:
    image: postgres
    env_file:
      - ./postgres/environment
    ports:
      - "5432:5432"
    secrets:
      - postgres_user
      - postgres_password
    volumes:
      - postgres-data:/var/lib/postgres/data/
      - ./postgres/init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    restart: always

      #  nextcloud:


